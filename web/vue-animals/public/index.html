<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link rel="icon" href="<%= BASE_URL %>favicon.ico"/>
      <link href="animals.css" type="text/css" rel="stylesheet" />

    <title>Cute animals!</title>

  </head>
  <body>
    <div>
        <h1><a href="#front">Cute animal pics</a></h1>

    </div>
    <nav>
        <ul>
            <li><a href="#add">Add a cute animal pic</a></li>
            <li><a href="#show">Look at cute animal pics</a></li>
        </ul>
    </nav>

    <main>
      <div id="frontPage">
          <img id="miska" width="500px" src="miskalogo5.png" alt="Logo"/>
      </div>

      <div id="addPage">
        <div>Describe your cute animal:
            <label for="description">
                <select id="description">
                    <option value="item1" selected="selected">Supercute</option>
                    <option value="item2">Adorable</option>
                    <option value="item3">Lovely</option>
                    <option value="item4">Incredible</option>
                </select>
            </label>
        </div>
        <div>
            <label for="animal">
                What animal is it? <input id="animal" placeholder="Animal <3" type="text"/>
            </label>
        </div>
        <div>
            <label for="link">
                Add your link. <input id="link" placeholder="Link" type="text"/>
            </label>
        </div>
          <input type="submit" value="Submit" onclick="addPhoto()"/>
          <div id="photoresponse"></div>
      </div>

      <div id="showPage">
          <button type="button" onclick="searchDatabase()">Show cute animal pics.</button>
          <div id="results"></div>
      </div>

      <div id="Comments">
          <div id="realBigPicturePic"></div>
          <div id="bigPicturePage"></div>


          <div id="newcomment">
              Comment: <input type="text" id="comment" name="comment" pattern="" placeholder="Comment here!" />
          </div>
          <button type="button" id="commentbutton">Post your comment!</button>
          <div id="commentresponse"></div>
      </div>

  </main>

  <script>

    var json = null;

    if (window.location.hash === '#front' || json === null) {
      document.getElementById('addPage').style.display = 'none';
      document.getElementById('showPage').style.display = 'none';
      document.getElementById('Comments').style.display = 'none';
    }
    else if (window.location.hash === '#add'){
      document.getElementById('frontPage').style.display = 'none';
      document.getElementById('showPage').style.display = 'none';
      document.getElementById('Comments').style.display = 'none';
    }
    else if (window.location.hash === '#show') {
      document.getElementById('frontPage').style.display = 'none';
      document.getElementById('addPage').style.display = 'none';
      document.getElementById('Comments').style.display = 'none';
    }
    else if (window.location.hash === '#comment') {
        document.getElementById('frontPage').style.display = 'none';
        document.getElementById('addPage').style.display = 'none';
        document.getElementById('showPage').style.display = 'none';
    }

    document.querySelector('nav > ul > li:nth-child(1)').onclick = function() {
      console.log('first link clicked');
      document.getElementById('addPage').style.display = 'block';
      document.getElementById('frontPage').style.display = 'none';
      document.getElementById('showPage').style.display = 'none';
      document.getElementById('Comments').style.display = 'none';
    };

    document.querySelector('nav > ul > li:nth-child(2)').onclick = function() {
      console.log('second link clicked');
      document.getElementById('showPage').style.display = 'block';
      document.getElementById('addPage').style.display = 'none';
      document.getElementById('frontPage').style.display = 'none';
      document.getElementById('Comments').style.display = 'none';
      searchDatabase();
    };

    document.querySelector('h1').onclick = function(){
        console.log("heading1 clicked");
        document.getElementById('frontPage').style.display = 'block';
        document.getElementById('addPage').style.display = 'none';
        document.getElementById('showPage').style.display = 'none';
        document.getElementById('Comments').style.display = 'none';
    };

    function showCommentsElement() {
        console.log("image clicked");
        document.getElementById('Comments').style.display = 'block';
        document.getElementById('addPage').style.display = 'none';
        document.getElementById('showPage').style.display = 'none';
        document.getElementById('frontPage').style.display = 'none';
    }

    function searchDatabase() {
        console.log("Painoit nappia");
        var number = new XMLHttpRequest();
        number.onreadystatechange = function () {
            if (number.readyState === 4 && number.status === 200) {
                json = JSON.parse(number.responseText);
                var lenght = 0;
                for (var key in json) {
                    if (json.hasOwnProperty(key)) {
                        lenght++;
                    }
                }
                key = 1; //i= kuvan id:n nimi, id on myös sama, kuin tietokannassa id
                if (lenght > 0) {
                    console.log(json[0].id);
                    console.log(json[0].linkki);
                    var divElement = document.getElementById("results");
                    divElement.innerText = "";
                    var i;
                    //Haetaan tietokannasta tiedot ja lisätään kuva, läpinäkyvän kuvan päälle
                    for (i in json) {
                        //Jos nämä kaksi riviä ottaa pois kommenteista, kuvat saa allekkain helposti
                        //var unOnrder = document.createElement("ul");
                        //divElement.appendChild(unOnrder);
                        //var listElement = document.createElement("li");
                        var pic = json[i].linkki;
                        key = json[i].id;
                        console.log(json[i].linkki);
                        console.log(json[i].id);
                        makePicture(pic, key);
                        //let img = document.getElementById("image");
                        //img.setAttribute("scr", json[i].linkki);
                        //listElement.innerHTML = pic;
                        //unOnrder.appendChild(listElement);
                        //console.log("Bonus logi");
                    }
                }
            }
        };
        number.open("GET", "http://localhost:8081/cutiepie");
        number.send();
    }

    function searchDatabase2(key) {
        var animalNumber = parseInt(key);
        console.log(animalNumber);
        var number = new XMLHttpRequest();
        number.onreadystatechange = function () {
            if (number.readyState === 4 && number.status === 200) {
                json = JSON.parse(number.responseText);
                var lenght = 0;
                for (var key in json) {
                    if (json.hasOwnProperty(key)) {
                        lenght++;
                    }
                }
                var key;

                var divElement = document.getElementById("bigPicturePage");
                divElement.innerText = "";

                if (lenght > 0) {
                    console.log(json[0].Kommentti);

                    var i;
                    for (i in json) {
                        var unOnrder = document.createElement("ul");
                        divElement.appendChild(unOnrder);
                        var listElement = document.createElement("li");
                        var comment = json[i].Kommentti;
                        console.log(json[i].Kommentti);
                        //showComment(comment);
                        listElement.innerHTML = comment;
                        unOnrder.appendChild(listElement);
                    }
                } else {
                    var unOnrder = document.createElement("ul"); //Kommentti kuviin jossa ei ole kommentteja, nimesin elementin listElement2:ksi jotta sen voi myöhemmin muotoilla css:ssä eri näköiseksi
                    divElement.appendChild(unOnrder);
                    var listElement2 = document.createElement("li");
                    var comment = "Ei yhtään kommentteja! Olisikko sinulla jotain sanottavaa tästä söpöläisestä?";
                    listElement2.innerHTML = comment;
                    unOnrder.appendChild(listElement2);
                }
            }
        };
        number.open("GET", "http://localhost:8081/puppies?Avain=" + animalNumber); //Tämä osoite on väärin, mutta miten?
        number.send();
    }

    function searchDatabase3(key) { //Hakee tietoknnasta valitun kuvan isona
        var animalNumber =  parseInt(key); //Muuttaa string muotoisen key:n intiksi.
        var number = new XMLHttpRequest();
        number.onreadystatechange = function() {
            if (number.readyState === 4 && number.status === 200) {
                json = JSON.parse(number.responseText);
                var lenght = 0;
                for (var key in json) {
                    if (json.hasOwnProperty(key)) {
                        lenght++;
                    }
                }
                var key;
                if (lenght > 0) {
                    //console.log(json[0].Linkki);

                    var divElement = document.getElementById("realBigPicturePic");
                    divElement.innerText = "";
                    var i;
                    for (i in json) {
                        var unOnrder = document.createElement("ul");
                        divElement.appendChild(unOnrder);
                        var listElement = document.createElement("li");
                        var pic = json[i].Linkki;
                        //console.log(json[i].Linkki);
                        makeBigPicture(pic);
                    }
                }
            }
        };
        number.open("GET", "http://localhost:8081/animalbabys?id="+animalNumber);
        number.send();

        //essi kokeilee
        var commenttemp = document.getElementById("commentbutton");
        commenttemp.setAttribute("onclick", "addComment("+ key +")");
    }

        //Lisää läpinäkyvän kuvan sivulle
        function makePicture(pic, key) {

            var link = document.createElement("a");

            //essin lisäys
            link.setAttribute("class", "photovar");

            //link.href = "page.html";
            var x = document.createElement("img");
            x.setAttribute("src", pic);
            x.setAttribute("id", key);
            //x.setAttribute("width", "200");
            x.setAttribute("height", "200");

            x.setAttribute("onclick", "bigPicture(" + key + " );");
            //x.setAttribute("onclick", "showComment("+key+" );");
            //x.onclick = bigPicture(key);
            //x.setAttribute("href", "page.html");
            link.appendChild(x);

            //muutos: jotta menee oikeaan elementtiin
            let resultselement = document.getElementById('results');
            resultselement.appendChild(link);

            console.log("Kuva luotu!");
            console.log(key);
            console.log(pic);
        }

    /*function showComment(comment) {
       var link2 = document.createElement("b");
       console.log(comment);
       var y = document.createElement("ul");
       y.setAttribute("text", comment);
       link2.appendChild(y);
       document.body.appendChild(link2);
   }*/

   function bigPicture(key) { //Kutsuu tietokantafunktiota ja lisää kommentit niille luotuun elementtiin

       //essi kokeilee kommenttielementtijuttua
       var photovar = document.getElementsByClassName("photovar");
       var i;
       for (i = 0; i < photovar.length; i++) {
           photovar[i].setAttribute("href", "#comment");
       }
       showCommentsElement();

       searchDatabase2(key);
       realBigPicture(key); //Kutsuu funktiota jolla tehdään valittu kuva isona.
       var bigPic = document.getElementById("bigPicturePage");
       //var text = document.createTextNode(key); //Tekee tekstille elementin
       //bigPic.appendChild(text); //Tulostaa kuvan id:n elementtiin
   }

  function realBigPicture(key) {
      console.log("Kohta tulee kuva "+key);
      searchDatabase3(key);
      var realBigPic = document.getElementById("realBigPicturePage");
  }
  function makeBigPicture(pic) {
      var link = document.createElement("a");
      let noPic = document.getElementById("realBigPicturePic");
      var x = document.createElement("img");
      x.setAttribute("src", pic);
      x.setAttribute("height", "400");
      link.appendChild(x);
      noPic.appendChild(link);
      console.log("Iso kuva luotu!");
      console.log(pic);
  }


   function addPhoto() {
       var xhttp = new XMLHttpRequest();
       var data = {};
       //data.kuvaus = document.getElementById('description');
       var e = document.getElementById("description");
       data.kuvaus = e.options[e.selectedIndex].text;

       console.log("data.kuvaus: " +data.kuvaus);
       var elain = document.getElementById('animal');
       data.elain = elain.value;
       var linkki = document.getElementById('link');
       data.linkki = linkki.value;
       console.log(data.elain);
       console.log("data: " + data);
       var json1 = JSON.stringify(data);
       console.log("json:" + json1);

       xhttp.onreadystatechange = function () {
           if (this.readyState === 4 && this.status === 200) {
               console.log("Responsetext: " + xhttp.responseText);

               var photoresponse = document.getElementById("photoresponse");
                photoresponse.innerHTML = "You have added a cute pic!"
           }
       };
       xhttp.open("POST", "http://localhost:8081/postphoto/", true);
       xhttp.setRequestHeader('Content-type', 'application/json');
       xhttp.send(json1);

       //reset values
        elain.value = "";
        linkki.value = "";

        document.getElementById("description").selectedIndex = 0;
   };

   function addComment(key){
        console.log("sisällä addcommentissa ja kuva nro " + key);

       var xhttp = new XMLHttpRequest();
       var data1 = {};

       var comment = document.getElementById('comment');
       data1.comment = comment.value;

       data1.key = key;
       console.log("data1.key = " + data1.key);
       console.log("data: " + data1);
       var json2 = JSON.stringify(data1);
       console.log("json:" + json2);

       xhttp.onreadystatechange = function () {
           if (this.readyState === 4 && this.status === 200) {
               console.log("Responsetext: " + xhttp.responseText);

               var commentresponse = document.getElementById("commentresponse");
               commentresponse.innerHTML = "You added a cute comment!"
               searchDatabase2(key);
           }
       };
       xhttp.open("POST", "http://localhost:8081/postcomment/", true);
       xhttp.setRequestHeader('Content-type', 'application/json');
       xhttp.send(json2);

       //reset values
       comment.value = "";

       //show new comment

   }
    </script>
    <!-- built files will be auto injected -->
  </body>
</html>


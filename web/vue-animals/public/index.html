<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <link rel="icon" href="<%= BASE_URL %>favicon.ico">

  <title>vue-animals</title>
  <script src="../../../api/server.js"></script>
  <script src="../../js/localstore.js"></script>

</head>
<body>
<button type="button" onclick="searchDatabase()">Hae kuvat</button>
<div id="results"></div>


<div id="Comments">
  <div id="bigPicturePage"></div>
  <div id="CommentsFromDatabase"></div>
  <p>Tähän tulee iso kuva ja kommentteja</p>


</div>



</body>

<script>
  var json;



  function searchDatabase() {

    console.log("Painoit nappia");

    var number = new XMLHttpRequest();
    number.onreadystatechange = function() {
      if (number.readyState == 4 && number.status == 200) {
        json = JSON.parse(number.responseText);

        var lenght = 0;
        for (var key in json) {
          if (json.hasOwnProperty(key)) {
            lenght++;
          }
        }
        var key=1; //i= kuvan id:n nimi, id on myös sama, kuin tietokannassa id

        if (lenght > 0) {
          console.log(json[0].id);
          console.log(json[0].linkki);


          var divElement = document.getElementById("results");
          divElement.innerText = "";
          var i;

          //Haetaan tietokannasta tiedot ja lisätään kuva, läpinäkyvän kuvan päälle
          for (i in json) {

            var unOnrder = document.createElement("ul");
            divElement.appendChild(unOnrder);

            var listElement = document.createElement("li");

            var pic = json[i].linkki;
            var key = json[i].id;

            console.log(json[i].linkki);
            console.log(json[i].id);

            makePicture(pic,key);

            //let img = document.getElementById("image");
            //img.setAttribute("scr", json[i].linkki);
            //listElement.innerHTML = pic;
            //unOnrder.appendChild(listElement);
            //console.log("Bonus logi");
          }
        }

      }
    };

    number.open("GET", "http://localhost:8081/cutiepie");
    number.send();
  }

  function searchDatabase2(key) {

    console.log("Painoit kommenttejen haku nappia");

    var animalNumber =  parseInt(key);
    console.log(animalNumber);


    var number = new XMLHttpRequest();
    number.onreadystatechange = function() {
      if (number.readyState == 4 && number.status == 200) {
        json = JSON.parse(number.responseText);

        var lenght = 0;
        for (var key in json) {
          if (json.hasOwnProperty(key)) {
            lenght++;
          }
        }
        var key;

        if (lenght > 0) {

          console.log(json[0].Kommentti);


          var divElement = document.getElementById("CommentsFromDatabase");
          divElement.innerText = "";
          var i;


          for (i in json) {
            var unOnrder = document.createElement("ul");
            divElement.appendChild(unOnrder);
            var listElement = document.createElement("li");
            var comment = json[i].Kommentti;
            console.log(json[i].Kommentti);
            showComment(comment);

            listElement.innerHTML = comment;
            unOnrder.appendChild(listElement);


          }
        }

      }
    };

    number.open("GET", "http://localhost:8081/puppies?Avain="+animalNumber); //Tämä osoite on väärin, mutta miten?
    number.send();
  }



  //Lisää läpinäkyvän kuvan sivulle
  function makePicture(pic,key) {

    var link = document.createElement("a");

    //link.href = "page.html";

    var x = document.createElement("img");
    x.setAttribute("src", pic);
    x.setAttribute("id", key);
    //x.setAttribute("width", "200");
    x.setAttribute("height", "200");
    x.setAttribute("onclick", "bigPicture("+key+" );");
    //x.setAttribute("onclick", "showComment("+key+" );");
//x.onclick = bigPicture(key);
    //x.setAttribute("href", "page.html");
    link.appendChild(x);

    document.body.appendChild(link);

    console.log("Kuva luotu!");
    console.log(key);
    console.log(pic);


  }

  function showComment(comment) {
    var link2 = document.createElement("b");

    console.log(comment);

    var y = document.createElement("ul");
    y.setAttribute("text", comment);

    link2.appendChild(y);
    document.body.appendChild(link2);

  }

  function bigPicture(key) {

    //console.log("Täällä on kuva:"+pic);
    console.log("Kohta tapahtuu!"+key);
    console.log("Komentti luotu");

    searchDatabase2(key);


    var bigPic = document.getElementById("bigPicturePage");
    //var text = document.createTextNode(key); //Tekee tekstille elementin
    //bigPic.appendChild(text); //Tulostaa kuvan id:n elementtiin








  }



  /*
    function addPhoto() {
          var xhttp = new XMLHttpRequest();
          var data = {};
          //data.kuvaus = document.getElementById('description');
          data.kuvaus = document.getElementById('description').value;
          data.elain = document.getElementById('animal').value;
          data.linkki = document.getElementById('link').value;
          console.log(data.elain);
          console.log("data: "+ data);
          var json1 =JSON.stringify(data);
          console.log("json:" + json1);

          xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
              console.log("Responsetext: " + xhttp.responseText);
            }
          };
          xhttp.open("POST", "http://localhost:8081/postphoto/", true);
          xhttp.setRequestHeader('Content-type', 'application/json');
          xhttp.send(json1);
        };



   */

</script>




</html>

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link rel="icon" href="<%= BASE_URL %>favicon.ico">

    <title>vue-animals</title>
    <script src="WebstormProjects/animals/api/server.js"></script>
    <script src="../../js/localstore.js"></script>
    <script src="../../js/frontscript.js"></script>
  </head>
  <h1><a href="#front">Cute animal pics</a></h1>
  <nav>
    <ul>
      <li><a href="#add">Add a cute animal pic</a></li>
      <li><a href="#look">Look at cute animal pics</a></li>
    </ul>
  </nav>
  <main>
      <div id="frontPage">
        <p>Tähän tulee logo</p>

      </div>

      <div id="addPage">
        <div id="description">
          Desccribe your cute animal: <select name="description"/>
          <option value="item1">Supercute</option>
          <option value="item2">Adorable</option>
          <option value="item3">Lovely</option></select>
        </div>
        <div>
          <input id="animal" placeholder="Animal <3" type="text">What animal is it?</input>
        </div>
        <div>
          <input id="link" placeholder="Link" type="text">Add your link.</input>
        </div>
        <button id="addphoto" type="button" onclick="addPhoto()">Add a cute animal photo!</button>
      </div>

      <div id="showPage">
        <button type="button" onclick="searchDatabase()">Hae kuvat</button>
        <div id="results"></div>
      </div>

      <div id="commentPage"></div>

  </main>

  <script>

    var json;

    if (window.location.hash == '#front' || json === null) {
      document.getElementById('addPage').style.display = 'none';
      document.getElementById('showPage').style.display = 'none';
      document.getElementById('commentPage').style.display = 'none';
    } else if (window.location.hash == '#add'){
      document.getElementById('frontPage').style.display = 'none';
      document.getElementById('showPage').style.display = 'none';
      document.getElementById('commentPage').style.display = 'none';
    } else if (window.location.hash == '#show') {
      document.getElementById('frontPage').style.display = 'none';
      document.getElementById('addPage').style.display = 'none';
      document.getElementById('commentPage').style.display = 'none';
    } else {
      document.getElementById('frontPage').style.display = 'none';
      document.getElementById('addPage').style.display = 'none';
      document.getElementById('showPage').style.display = 'none';
    }

    document.querySelector('nav > ul > li:nth-child(1)').onclick = function() {
      console.log('first link clicked');

      document.getElementById('addPage').style.display = 'block';
      document.getElementById('frontPage').style.display = 'none';
      document.getElementById('showPage').style.display = 'none';
      document.getElementById('commentPage').style.display = 'none';
    };

    document.querySelector('nav > ul > li:nth-child(2)').onclick = function() {
      console.log('second link clicked');
      document.getElementById('showPage').style.display = 'block';
      document.getElementById('addPage').style.display = 'none';
      document.getElementById('showPage').style.display = 'none';
      document.getElementById('commentPage').style.display = 'none';

      searchDatabase();
    };


    function searchDatabase() {
      console.log("Painoit nappia");
      var number = new XMLHttpRequest();
      number.onreadystatechange = function() {
        if (number.readyState == 4 && number.status == 200) {
          json = JSON.parse(number.responseText);
          var lenght = 0;
          for (var key in json) {
            if (json.hasOwnProperty(key)) {
              lenght++;
            }
          }
          var key=1; //i= kuvan id:n nimi, id on myös sama, kuin tietokannassa id
          if (lenght > 0) {
            console.log(json[0].id);
            console.log(json[0].linkki);
            var divElement = document.getElementById("results");
            divElement.innerText = "";
            var i;
            //Haetaan tietokannasta tiedot ja lisätään kuva, läpinäkyvän kuvan päälle
            for (i in json) {
              var unOnrder = document.createElement("ul");
              divElement.appendChild(unOnrder);
              var listElement = document.createElement("li");
              var pic = json[i].linkki;
              var key = json[i].id;
              console.log(json[i].linkki);
              console.log(json[i].id);
              makePicture(pic,key);
              //let img = document.getElementById("image");
              //img.setAttribute("scr", json[i].linkki);
              //listElement.innerHTML = pic;
              //unOnrder.appendChild(listElement);
              //console.log("Bonus logi");
            }
          }
        }
      };
      number.open("GET", "http://localhost:8081/cutiepie");
      number.send();
    }
    //Lisää läpinäkyvän kuvan sivulle
    function makePicture(pic,key) {
      var link = document.createElement("a");
      link.href = "page.html";
      var x = document.createElement("img");
      x.setAttribute("src", pic);
      x.setAttribute("id", key);
      //x.setAttribute("width", "200");
      x.setAttribute("height", "200");
      //x.setAttribute("href", "page.html");
      link.appendChild(x);
      document.body.appendChild(link);
      console.log("Kuva luotu!");
    }

      function addPhoto() {
        var xhttp = new XMLHttpRequest();
        var data = {};
        //data.kuvaus = document.getElementById('description');
        data.kuvaus = document.getElementById('description').value;
        data.elain = document.getElementById('animal').value;
        data.linkki = document.getElementById('link').value;
        console.log(data.elain);
        console.log("data: "+ data);
        var json1 =JSON.stringify(data);
        console.log("json:" + json1);

        xhttp.onreadystatechange = function() {
          if (this.readyState == 4 && this.status == 200) {
            console.log("Responsetext: " + xhttp.responseText);
          }
        };
        xhttp.open("POST", "http://localhost:8081/postphoto/", true);
        xhttp.setRequestHeader('Content-type', 'application/json');
        xhttp.send(json1);
      };

    </script>
    <!-- built files will be auto injected -->
  </body>
</html>
